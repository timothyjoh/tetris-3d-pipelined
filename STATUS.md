# Project Status

> Auto-generated by cc-pipeline. Last updated after Phase 1.

## Overview
A single-page Tetris clone built with Three.js and Vite, deployable to Vercel. Classic 2D Tetris mechanics rendered with a Tron-inspired neon aesthetic — dark background, glowing emissive blocks, grid overlay, and bloom post-processing.

**Current state:** The game is fully playable. Open `localhost:5173` after `npm run dev` and you get all 7 tetrominoes falling, keyboard controls, wall kicks, line clearing, scoring, leveling, and a game-over screen with restart. The Three.js renderer shows neon-colored blocks with `UnrealBloomPass` glow and a grid overlay. Board tilt, sound effects, and the leaderboard are not yet built.

---

## Phase 1: Tetris Engine + Three.js Rendering + Tron Aesthetic

### What We Built
- Complete Vite + Vanilla JS project scaffold replacing a prior unrelated `mdtoc` CLI config
- Pure-JS Tetris engine (`src/engine/`): 10×20 board, all 7 tetrominoes with SRS rotation and wall kicks, standard gravity speed curve (1000ms→17ms across 20 levels), 500ms lock delay with 15-reset cap, line clear + row shift, scoring (100/300/500/800 × level), level progression every 10 lines
- Three.js WebGL renderer: `WebGLRenderer`, `OrthographicCamera`, pre-allocated 220-mesh block pool toggled per frame (no per-frame GC), `MeshStandardMaterial` with `emissive` color for neon look
- `UnrealBloomPass` post-processing via `EffectComposer` + `OutputPass` using `three/addons/` (no extra npm package)
- `LineSegments` grid overlay on the board; dark background plane behind cells
- DOM HUD over the canvas: live score, level, lines cleared, next-piece preview (2D canvas), game-over overlay with "PLAY AGAIN" button
- Keyboard controls: Arrow Left/Right (move), Arrow Up / X (rotate CW), Z (rotate CCW), Arrow Down (soft drop), Space (hard drop), P (pause)
- `AGENTS.md`, `README.md`, `CLAUDE.md` updates

### How to Run It
```
npm install
npm run dev      # open localhost:5173
```
A piece spawns immediately and falls. Use arrow keys and Space to play. P pauses. On game over, click "PLAY AGAIN" to restart. Production build: `npm run build` → `dist/index.html`.

### Review Findings
- **Lock delay bug (fixed):** Initial implementation accumulated `_lockAccum` with the gravity period instead of real `dt`, so at level 1 the piece locked on the first gravity tick (~1000ms) rather than after an independent 500ms window. Fixed by restructuring `update()` to accumulate lock time every frame when `_landed === true`, independent of gravity cadence.
- **Incomplete 4-line clear test (fixed):** A test left a wrong bug comment claiming `clearRows` had a splice/unshift issue; the implementation was actually correct. Test was rewritten with full row-shift assertions.
- **`update(dt)` untested initially (fixed):** The core gravity/lock loop had 0% function coverage in the first pass. Six tests were added covering gravity ticks, lock-after-500ms, soft drop interval selection, and pause/over guards.
- **Multi-line scoring missing (fixed):** 2-line (300pts), 4-line (800pts), and level-multiplier (200pts for 1-line at level 2) tests were added.
- **Deferred (known debt):** Redundant `isInBounds` check in `board.js:42`, dead `onRestart` callback parameter in `input.js`, redundant `randomPieceType()` call in `restart()`, no keyboard restart shortcut (mouse click only).

### What's Next
- **Phase 2:** Board tilt effect — Z-axis rotation tracking active piece column (±7° max), spring/damping oscillation back to 0° on piece landing. Web Audio API 8-bit sound effects (move, rotate, soft/hard drop, line clear, Tetris, level up, game over). Polish: ghost piece preview, lock flash, line-clear animation.
- **Phase 3:** Local leaderboard (top 10 in localStorage), initials entry on game over, Vercel deploy config, final QA.
- Known limitations: keyboard-only (no mobile touch), no sound, no ghost piece, no leaderboard.

### Test Coverage
- **Test command:** `npm run test` / `npm run test:coverage`
- **Results:** 115 tests passing, 0 failing across 4 test files
- **Coverage (engine modules):**

  | File           | Stmts  | Branch | Funcs  | Lines  |
  |----------------|--------|--------|--------|--------|
  | board.js       | 100%   | 100%   | 100%   | 100%   |
  | gameState.js   | 96.81% | 95.83% | 85.71% | 96.81% |
  | rotation.js    | 100%   | 81.81% | 100%   | 100%   |
  | tetrominoes.js | 100%   | 100%   | 100%   | 100%   |
  | **All files**  | **98.54%** | **95.5%** | **91.42%** | **98.54%** |

- Engine line coverage: **98.54%** (target: ≥ 80%)
- Not covered: renderer modules (`scene.js`, `blockPool.js`, `composer.js`, `render.js`, `hud.js`) — all require a WebGL context unavailable in Node; no E2E tests per spec

---
